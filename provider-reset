#!/bin/bash
#

if [ -f /var/cache/provider/done ];
then
	exit
fi

homedir=/home/owner
# ensure any google-chrome profiles created are removed
rm -rf $homedir/.{config,cache}/google-chrome
rm -f $homedir/.config/{gnome-initial-setup-done,kramden-gsettings-prime-done}
rm -rf $homedir/.config/autostart
rm -rf $homedir/.local/share/applications

# ensure all installed snaps have no user data
rm -rf $homedir/snap

# delete rc.local as it was only needed for provisioning
rm -f /etc/rc.local

mkdir -p /var/cache/provider
touch /var/cache/provider/done

# Delete the Kramden Deployment wifi connection
nmcli c delete kramden-deployment 2/dev/null || true

# Add connection for Kramden Guest network
nmcli device wifi connect "Kramden Guest" password iamatkramden name kramden-guest 2/dev/null || true

# poweroff
poweroff
